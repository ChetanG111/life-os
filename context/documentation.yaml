# ╔═══════════════════════════════════════════════════════════════════════════════╗
# ║                              LIFE OS DOCUMENTATION                             ║
# ║                     Personal Productivity Second Brain App                    ║
# ╚═══════════════════════════════════════════════════════════════════════════════╝
#
# This documentation covers all implemented features, architecture patterns, and
# reusable systems in Life OS. Read this before modifying any code.
#
# Last Updated: 2026-01-19
# Version: 0.3.0 (Responsive Update)

---
# ════════════════════════════════════════
# OVERVIEW
# ════════════════════════════════════════
overview:
  name: "Life OS"
  description: |
    Life OS is a mobile-first, gesture-driven personal productivity app built with 
    Next.js and Framer Motion. It features a premium dark-mode interface with 
    distinct layouts for mobile (swipe-heavy) and desktop (information-dense).
  
  philosophy:
    - "Tool, not toy - high signal, low noise"
    - "Gesture-first navigation - swipe to navigate, swipe to act"
    - "Premium feel - animations must feel physical and satisfying"
    - "Responsive but optimized - unique layouts per screen size, not just scaling"
    - "Zero visual distraction - minimal, clean, and focused"
  
  tech_stack:
    framework: "Next.js 14+ (App Router)"
    animations: "Framer Motion 11+"
    styling: "Tailwind CSS 4"
    icons: "Lucide React"
    language: "TypeScript"
    font: "Fredoka (Google Fonts)"


---
# ════════════════════════════════════════
# PROJECT STRUCTURE
# ════════════════════════════════════════
project_structure:
  root_files:
    - "documentation.yaml   # This file - complete system documentation"
    - "1.instructions.md    # Quick start and development notes"
    - "ARCHITECTURE.md      # High-level architecture overview"
    - "README.md            # Project readme"
  
  context_folder:
    path: "context/"
    files:
      - "design.yaml        # Design system tokens and motion rules"
  
  src_folder:
    path: "src/"
    subdirectories:
      app:
        description: "Next.js App Router pages and layouts"
        files:
          - "layout.tsx     # Root layout with providers"
          - "page.tsx       # Main entry point (renders NavigationShell)"
          - "globals.css    # Global styles and CSS variables"
      
      components:
        description: "All React components organized by feature"
        subdirectories:
          layout:
            description: "Navigation and shell components"
            files:
              - "NavigationShell.tsx  # Main app shell with tab switching"
              - "BottomNav.tsx        # Animated bottom navigation bar"
          
          features:
            description: "Feature-specific components"
            subdirectories:
              tasks: ["TasksTab.tsx", "TaskCard.tsx"]
              notes: ["NotesTab.tsx", "NoteCard.tsx"]
              weekly: ["WeeklyTab.tsx", "DayItem.tsx"]
              overview: ["Feed.tsx", "SwipeFeed.tsx", "ListFeed.tsx", "QuickAddModal.tsx", "StatePopup.tsx", "MemoryReviewCards.tsx"]
              chat: ["ChatTab.tsx"]
              settings: ["SettingsModal.tsx"]
              cards: ["CardDetailModal.tsx", "ConfirmDeleteModal.tsx"]
          
          ui:
            description: "Reusable UI primitives"
            files: ["Card.tsx"]
      
      context:
        description: "React Context providers for global state"
        files:
          - "DataContext.tsx      # Tasks, Notes, Settings, State history + persistence"
          - "SettingsContext.tsx  # Settings abstraction layer"
          - "MotionContext.tsx    # Dynamic spring configuration"
          - "ToastContext.tsx     # Toast notifications system"
      
      hooks:
        description: "Custom React hooks"
        files:
          - "use-back-to-close.ts  # Handle Android back button for modals"
          - "use-lock-body-scroll.ts  # Prevent body scroll when modal open"
          - "use-slimy-spring.ts   # Get current spring config from motion context"
      
      utils:
        description: "Utility functions and animation helpers"
        files:
          - "animations.ts   # Universal stagger animation system"
          - "haptics.ts      # Vibration patterns for feedback"
      
      types:
        description: "TypeScript type definitions"
        files:
          - "index.ts   # Task, Note, TabId, and other types"
      
      data:
        description: "Mock data for development"
        files:
          - "mock.ts   # Sample tasks and notes"


---
# ════════════════════════════════════════
# DATA & STATE MANAGEMENT
# ════════════════════════════════════════
data_management:
  overview: |
    Life OS uses React Context for global state management, with automatic 
    persistence to localStorage. All data flows through the DataContext provider.

  # ─────────────────────────────────────
  # DataContext (Primary State Store)
  # ─────────────────────────────────────
  data_context:
    file: "src/context/DataContext.tsx"
    description: |
      The central state store that manages all application data including tasks, 
      notes, and settings. Provides CRUD operations and automatic localStorage 
      persistence.
    
    exports:
      DataProvider:
        type: "React Component"
        description: "Wraps the app to provide data context"
        usage: |
          // In layout.tsx (already implemented)
          <DataProvider>
            <SettingsProvider>
              <MotionProvider>
                {children}
              </MotionProvider>
            </SettingsProvider>
          </DataProvider>
      
      useData:
        type: "React Hook"
        description: "Access data context in any component"
        returns:
          tasks: "Task[] - Array of all tasks"
          notes: "Note[] - Array of all notes"
          settings: "AppSettings - Current settings object"
          addTask: "(task: Omit<Task, 'id' | 'isCompleted'>) => void"
          removeTask: "(id: string) => void"
          addNote: "(note: Omit<Note, 'id' | 'date'>) => void"
          removeNote: "(id: string) => void"
          updateSettings: "(updates: Partial<AppSettings>) => void"
        
        usage: |
          import { useData } from '@/context/DataContext';
          
          function MyComponent() {
            const { tasks, addTask, removeTask } = useData();
            
            // Add a new task
            addTask({
              title: 'New Task',
              priority: 'medium',
              tags: ['work'],
              description: 'Task description',
            });
            
            // Remove a task
            removeTask('task-id');
          }
    
    settings_interface:
      properties:
        autoFocusQuickAdd:
          type: "boolean"
          default: true
          description: "Whether to auto-focus input when QuickAddModal opens"
        
        motionIntensity:
          type: "number (0-100)"
          default: 50
          description: "Controls spring animation bounciness"
        
        showBottomNav:
          type: "boolean"
          default: true
          description: "Show/hide the bottom navigation pill bar"
        
        confirmDelete:
          type: "boolean"
          default: true
          description: "Show confirmation modal before deleting items"
    
    persistence:
      mechanism: "localStorage"
      keys:
        tasks: "life-os-tasks"
        notes: "life-os-notes"
        settings: "life-os-settings"
      
      how_it_works: |
        1. On app load, data is read from localStorage (or mock data if empty)
        2. The `isLoaded` flag prevents hydration mismatches
        3. Separate useEffect hooks save each data type when changed
        4. Children only render after data is loaded (prevents flicker)
    
    adding_new_settings: |
      To add a new setting:
      1. Add the property to the AppSettings interface
      2. Add default value to DEFAULT_SETTINGS
      3. It will auto-persist to localStorage
      4. Access via useData().settings.yourNewSetting
      5. Update via useData().updateSettings({ yourNewSetting: value })

  # ─────────────────────────────────────
  # SettingsContext (Convenience Layer)
  # ─────────────────────────────────────
  settings_context:
    file: "src/context/SettingsContext.tsx"
    description: |
      A convenience abstraction over DataContext for settings. Provides direct 
      getters and setters for common settings without needing updateSettings().
    
    exports:
      SettingsProvider:
        type: "React Component"
        usage: "Already wrapped in layout.tsx (inside DataProvider)"
      
      useSettings:
        type: "React Hook"
        returns:
          autoFocusQuickAdd: "boolean"
          setAutoFocusQuickAdd: "(value: boolean) => void"
          confirmDelete: "boolean"
          setConfirmDelete: "(value: boolean) => void"
        
        usage: |
          import { useSettings } from '@/context/SettingsContext';
          
          function MyComponent() {
            const { confirmDelete, setConfirmDelete } = useSettings();
            
            // Toggle setting
            setConfirmDelete(!confirmDelete);
          }
    
    why_two_contexts: |
      DataContext handles all data + raw settings object.
      SettingsContext provides individual getter/setter pairs for convenience.
      This separation keeps components clean and focused.


---
# ════════════════════════════════════════
# ANIMATION SYSTEM
# ════════════════════════════════════════
animation_system:
  overview: |
    Life OS has a sophisticated animation system built on Framer Motion. It features 
    user-adjustable spring physics, universal stagger animations, and gesture-based 
    interactions. All animations feel physical and "slimy" - bouncy with overshoot.

  # ─────────────────────────────────────
  # Motion Context (Dynamic Springs)
  # ─────────────────────────────────────
  motion_context:
    file: "src/context/MotionContext.tsx"
    description: |
      Provides dynamic spring configuration that adjusts based on user preference.
      The "Motion Intensity" slider in settings controls how bouncy animations feel.
    
    exports:
      MotionProvider:
        type: "React Component"
        usage: "Already wrapped in layout.tsx"
      
      useMotion:
        type: "React Hook"
        returns:
          intensity: "number (0-100) - Current motion intensity"
          setIntensity: "(value: number) => void - Update intensity"
          getSpring: "() => SpringConfig - Get current spring values"
        
        usage: |
          import { useMotion } from '@/context/MotionContext';
          
          function MyComponent() {
            const { getSpring } = useMotion();
            const springConfig = getSpring();
            
            // Use in Framer Motion
            <motion.div
              animate={{ y: 0 }}
              transition={springConfig}
            />
          }
    
    intensity_mapping:
      description: |
        The intensity (0-100) maps to spring stiffness and damping using 
        linear interpolation (lerp). Lower = rigid/fast, Higher = bouncy/fluid.
      
      values:
        intensity_0:
          label: "Minimal"
          stiffness: 600
          damping: 60
          feel: "Fast, rigid, no bounce"
        
        intensity_50:
          label: "Balanced"
          stiffness: 410
          damping: 33.5
          feel: "Natural, subtle bounce"
        
        intensity_100:
          label: "Slimy"
          stiffness: 220
          damping: 7
          feel: "Fluid, chaotic bounce, high oscillation"

  # ─────────────────────────────────────
  # useSlimySpring Hook (Convenience)
  # ─────────────────────────────────────
  use_slimy_spring:
    file: "src/hooks/use-slimy-spring.ts"
    description: "Shorthand hook to get current spring config"
    
    usage: |
      import { useSlimySpring } from '@/hooks/use-slimy-spring';
      
      function MyComponent() {
        const springConfig = useSlimySpring();
        
        // springConfig = { type: "spring", stiffness: X, damping: Y }
        <motion.div transition={springConfig} />
      }

  # ─────────────────────────────────────
  # Universal Stagger System
  # ─────────────────────────────────────
  stagger_animations:
    file: "src/utils/animations.ts"
    description: |
      A centralized stagger animation system for consistent list/card entrance 
      animations. Follow iOS 18 fluid entrance patterns.
    
    design_tokens:
      standard_gap: "0.08s (80ms) - For task/note lists"
      modal_gap: "0.05s (50ms) - For dense modal content"
      initial_delay: "0.1s (100ms) - Delay before first item animates"
      slide_offset: "30px - Y-axis slide distance"
      entrance_scale: "0.9 - Scale on entrance"
    
    exports:
      STAGGER_CONFIG:
        type: "Object"
        description: "Raw timing constants"
        usage: |
          import { STAGGER_CONFIG } from '@/utils/animations';
          
          // STAGGER_CONFIG.standard = 0.08
          // STAGGER_CONFIG.modal = 0.05
          // STAGGER_CONFIG.initialDelay = 0.1
      
      UNIVERSAL_STAGGER_CONTAINER:
        type: "(mode: 'standard' | 'modal') => Variants"
        description: "Returns container variants for stagger parent"
        usage: |
          import { UNIVERSAL_STAGGER_CONTAINER } from '@/utils/animations';
          
          const containerVariants = UNIVERSAL_STAGGER_CONTAINER('standard');
          
          <motion.div
            variants={containerVariants}
            initial="hidden"
            animate="show"
          >
            {items.map(item => (
              <motion.div key={item.id} variants={itemVariants}>
                {item.content}
              </motion.div>
            ))}
          </motion.div>
      
      createStaggerItemVariants:
        type: "(springConfig: any) => Variants"
        description: "Creates item variants with the current spring config"
        usage: |
          import { createStaggerItemVariants } from '@/utils/animations';
          import { useSlimySpring } from '@/hooks/use-slimy-spring';
          
          function MyList() {
            const springConfig = useSlimySpring();
            const itemVariants = createStaggerItemVariants(springConfig);
            
            // itemVariants.hidden = { opacity: 0, y: 30, scale: 0.9 }
            // itemVariants.show = { opacity: 1, y: 0, scale: 1, transition: springConfig }
          }
    
    complete_implementation_example: |
      // Full example of stagger animation in a list component
      
      import { motion, AnimatePresence } from 'framer-motion';
      import { UNIVERSAL_STAGGER_CONTAINER, createStaggerItemVariants } from '@/utils/animations';
      import { useSlimySpring } from '@/hooks/use-slimy-spring';
      
      function TaskList({ tasks }) {
        const springConfig = useSlimySpring();
        const containerVariants = UNIVERSAL_STAGGER_CONTAINER('standard');
        const itemVariants = createStaggerItemVariants(springConfig);
        
        return (
          <motion.div
            variants={containerVariants}
            initial="hidden"
            animate="show"
            className="space-y-3"
          >
            <AnimatePresence mode="sync">
              {tasks.map((task) => (
                <motion.div
                  key={task.id}
                  variants={itemVariants}
                  layout
                  exit={{ opacity: 0, x: -20, transition: { duration: 0.2 } }}
                >
                  <TaskCard task={task} />
                </motion.div>
              ))}
            </AnimatePresence>
          </motion.div>
        );
      }
    
    where_implemented:
      - "TasksTab.tsx - Task list stagger"
      - "NotesTab.tsx - Notes grid stagger"
      - "WeeklyTab.tsx - Weekly days stagger"
      - "SettingsModal.tsx - Settings sections stagger"
      - "QuickAddModal.tsx - Type selector and content stagger"

  # ─────────────────────────────────────
  # Advanced Animation Coordination
  # ─────────────────────────────────────
  advanced_coordination:
    description: |
      To achieve a "Zero-Lag" premium feel, parent transitions (like a modal rising) 
      are coordinated with child stagger animations. Instead of waiting for the 
      parent to finish, children begin their stagger as soon as the parent enters.
    
    rules:
      1. Coordination: The parent container must manage the stagger settings 
         (staggerChildren, delayChildren) within its primary entrance transition.
      2. No Manual Delays: Avoid using fixed `delay` values on children. Let the 
         stagger system handle timing to maintain hardware acceleration and logic.
      3. Unified Variants: Use the same variant names (`hidden`, `show`, `exit`) 
         across parent and children to ensure a shared animation lifecycle.
      4. Slimy Physics: Always inject `useSlimySpring()` into the parent transition 
         to ensure the entire sheet and its contents feel like one physical unit.

  # ─────────────────────────────────────
  # Modal Animations
  # ─────────────────────────────────────
  modal_animations:
    description: "Standard animation pattern for bottom sheet modals"
    
    pattern: |
      All modals use the same high-performance pattern:
      - Coordinate rising sheet with internal staggers (Zero-Lag)
      - Use `useSlimySpring` for positional shifts (Non-linear, bouncy)
      - Drag-to-dismiss with haptic feedback
      - Backdrop blur with synchronized fade
    
    advanced_modal_variants: |
      // The standard variant structure for a premium Life OS modal
      const modalVariants = {
        hidden: { y: '100%', opacity: 0 },
        show: {
          y: 0,
          opacity: 1,
          transition: {
            ...springConfig,      // Bouncy spring
            staggerChildren: 0.05, // Rapid internal stagger
            delayChildren: 0.02,   // Start stagger 20ms after opening
          }
        },
        exit: {
          y: '100%',
          opacity: 0,
          transition: { duration: 0.2, ease: 'easeIn' }
        }
      };
    
    implementing_a_new_modal: |
      // Template for creating a new premium Life OS modal
      
      import { motion, AnimatePresence, useDragControls } from 'framer-motion';
      import { useBackToClose } from '@/hooks/use-back-to-close';
      import { useLockBodyScroll } from '@/hooks/use-lock-body-scroll';
      import { useSlimySpring } from '@/hooks/use-slimy-spring';
      import { createStaggerItemVariants } from '@/utils/animations';
      
      function NewModal({ isOpen, onClose }) {
        const springConfig = useSlimySpring();
        const itemVariants = createStaggerItemVariants(springConfig);
        
        return (
          <AnimatePresence>
            {isOpen && (
              <>
                <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} />
                <motion.div
                  variants={modalVariants}
                  initial="hidden"
                  animate="show"
                  exit="exit"
                  drag="y"
                  className="fixed inset-x-0 bottom-0 bg-[var(--surface)]"
                >
                   <motion.h2 variants={itemVariants}>Header First</motion.h2>
                   <motion.div variants={itemVariants}>Content Second</motion.div>
                </motion.div>
              </>
            )}
          </AnimatePresence>
        );
      }


---
# ════════════════════════════════════════
# HAPTIC FEEDBACK
# ════════════════════════════════════════
haptics:
  file: "src/utils/haptics.ts"
  description: |
    Provides vibration patterns for haptic feedback. Uses the Web Vibration API 
    (navigator.vibrate) which works on Android and some browsers.
  
  exports:
    vibrate:
      type: "(pattern: VibrationPattern) => void"
      patterns:
        light:
          duration: "10ms"
          usage: "Standard tap feedback, tab switches, minor interactions"
        
        medium:
          duration: "35ms"
          usage: "Toggle switches, swipe dismissals, button presses"
        
        heavy:
          duration: "60ms"
          usage: "Significant actions, drag starts"
        
        success:
          duration: "[20, 40, 20]ms"
          usage: "Task completion, successful saves"
        
        warning:
          duration: "[40, 60, 20]ms"
          usage: "Approaching limits, caution states"
        
        error:
          duration: "[60, 60, 60, 60]ms"
          usage: "Failed actions, validation errors"
  
  usage: |
    import { vibrate } from '@/utils/haptics';
    
    // On button click
    const handleClick = () => {
      vibrate('medium');
      doAction();
    };
    
    // On swipe complete
    if (swipeDirection === 'right') {
      vibrate('success');
      markComplete();
    }
  
  where_used:
    - "NavigationShell - Tab switches, FAB clicks"
    - "TaskCard - Drag start, swipe complete/delete"
    - "SettingsModal - Toggle switches"
    - "QuickAddModal - Voice toggle, submit"
    - "All modals - Drag-to-dismiss"


---
# ════════════════════════════════════════
# CUSTOM HOOKS
# ════════════════════════════════════════
hooks:
  # ─────────────────────────────────────
  # useBackToClose
  # ─────────────────────────────────────
  use_back_to_close:
    file: "src/hooks/use-back-to-close.ts"
    description: |
      Handles Android/browser back button to close modals instead of navigating away.
      Essential for mobile web app feel.
    
    how_it_works: |
      1. When modal opens: Pushes a dummy history state
      2. When back button pressed: popstate fires → calls onClose
      3. When closed via UI (not back button): Effect cleanup pops history
    
    usage: |
      import { useBackToClose } from '@/hooks/use-back-to-close';
      
      function MyModal({ isOpen, onClose }) {
        useBackToClose(isOpen, onClose);
        
        return (
          <AnimatePresence>
            {isOpen && <ModalContent />}
          </AnimatePresence>
        );
      }
    
    important_notes:
      - "Always call at the top of modal component"
      - "The onClose callback should NOT push/pop history itself"
      - "Works in tandem with drag-to-dismiss"
  
  # ─────────────────────────────────────
  # useLockBodyScroll
  # ─────────────────────────────────────
  use_lock_body_scroll:
    file: "src/hooks/use-lock-body-scroll.ts"
    description: |
      Prevents body scroll when a modal is open. Prevents iOS pull-to-refresh 
      and scroll-behind issues.
    
    how_it_works: |
      1. When isLocked=true: Sets document.body.style.overflow = 'hidden'
      2. When isLocked=false (or unmount): Restores original overflow
    
    usage: |
      import { useLockBodyScroll } from '@/hooks/use-lock-body-scroll';
      
      function MyModal({ isOpen }) {
        useLockBodyScroll(isOpen);
        // Body scroll now locked when modal is open
      }
  
  # ─────────────────────────────────────
  # useSlimySpring
  # ─────────────────────────────────────
  use_slimy_spring:
    file: "src/hooks/use-slimy-spring.ts"
    description: "Convenience hook to get current spring configuration"
    
    usage: |
      import { useSlimySpring } from '@/hooks/use-slimy-spring';
      
      function MyComponent() {
        const springConfig = useSlimySpring();
        // Returns: { type: "spring", stiffness: X, damping: Y }
      }
    
    note: |
      This is just syntactic sugar over useMotion().getSpring().
      Use when you only need the spring config and not intensity/setIntensity.


---
# ════════════════════════════════════════
# SETTINGS MENU
# ════════════════════════════════════════
settings_menu:
  file: "src/components/features/settings/SettingsModal.tsx"
  description: |
    Full-screen bottom sheet modal for app settings. Features stagger animations, 
    toggle switches, and the motion intensity slider.
  
  opening_the_settings: |
    Settings modal is opened by tapping the title in any tab header.
    The onOpenSettings callback is passed through NavigationShell → TabContent → Tab.
    
    Example in a tab:
    <motion.button onClick={onOpenSettings}>
      <h1>Tasks</h1>
    </motion.button>
  
  current_settings:
    motion_intensity:
      section: "Experience"
      type: "Slider (0-100)"
      description: "Adjusts spring stiffness/damping for all animations"
      implementation: |
        Uses useMotion() context to read/write intensity.
        Changes are automatically persisted to localStorage.
    
    bottom_navigation:
      section: "Navigation"
      type: "Toggle Switch"
      description: "Show/hide the floating pill navigation bar"
      implementation: |
        Controlled via settings.showBottomNav in DataContext.
        Toggled via onToggleBottomNav prop from NavigationShell.
    
    auto_focus_keyboard:
      section: "Behavior"
      type: "Toggle Switch"
      description: "Auto-focus text input when QuickAddModal opens"
      implementation: "Uses SettingsContext.setAutoFocusQuickAdd()"
    
    confirm_deletion:
      section: "Behavior"
      type: "Toggle Switch"
      description: "Show confirmation modal before deleting items"
      implementation: "Uses SettingsContext.setConfirmDelete()"
  
  placeholder_settings:
    description: "These are UI placeholders for future implementation"
    items:
      - "Haptics & Motion - Future: Fine-tune haptic patterns"
      - "Display - Future: Theme options, typography"
      - "Backup & Sync - Future: Cloud sync, export/import"
  
  adding_a_new_setting: |
    1. Add property to AppSettings interface in DataContext.tsx
    2. Add default value to DEFAULT_SETTINGS
    3. (Optional) Add convenience getter/setter in SettingsContext.tsx
    4. Add UI control in SettingsModal.tsx:
    
    <motion.section variants={slimyItem}>
      <h3 className="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 px-1">
        Your Section
      </h3>
      <div className="bg-[var(--surface)] rounded-2xl overflow-hidden border border-white/5">
        <div className="flex items-center justify-between p-4">
          <div className="flex items-center gap-3">
            <div className="p-2 bg-blue-500/10 rounded-lg text-blue-500">
              <YourIcon size={20} />
            </div>
            <div>
              <p className="font-medium text-white">Your Setting</p>
              <p className="text-xs text-neutral-500">Description</p>
            </div>
          </div>
          
          <button
            onClick={() => {
              vibrate('medium');
              updateYourSetting(!currentValue);
            }}
            className={`relative w-12 h-7 rounded-full transition-colors ${
              currentValue ? 'bg-white' : 'bg-neutral-800'
            }`}
          >
            <motion.div
              animate={{ x: currentValue ? 22 : 2 }}
              transition={{ type: "spring", stiffness: 500, damping: 30 }}
              className="absolute top-1 left-0 w-5 h-5 bg-black rounded-full"
            />
          </button>
        </div>
      </div>
    </motion.section>
  
  toggle_switch_pattern: |
    Standard toggle switch implementation:
    
    <button
      onClick={() => {
        vibrate('medium');
        setYourState(!yourState);
      }}
      className={`relative w-12 h-7 rounded-full transition-colors duration-200 ${
        yourState ? 'bg-white' : 'bg-neutral-800'
      }`}
    >
      <motion.div
        initial={false}
        animate={{ x: yourState ? 22 : 2 }}
        transition={{ type: "spring", stiffness: 500, damping: 30 }}
        className="absolute top-1 left-0 w-5 h-5 bg-black rounded-full shadow-sm"
      />
    </button>


---
# ════════════════════════════════════════
# NAVIGATION SYSTEM
# ════════════════════════════════════════
navigation:
  overview: |
    Life OS uses a gesture-first navigation system. Users can swipe horizontally 
    to switch tabs, or tap the floating bottom navigation bar.
  
  # ─────────────────────────────────────
  # NavigationShell
  # ─────────────────────────────────────
  navigation_shell:
    file: "src/components/layout/NavigationShell.tsx"
    description: "Main app shell that manages tab switching, modals, and gestures"
    
    responsibilities:
      - "Manages active tab state"
      - "Handles swipe gestures for tab switching"
      - "Hosts all global modals (Settings, QuickAdd, CardDetail)"
      - "Renders the FAB (Floating Action Button)"
      - "Passes callbacks to child tabs"
    
    tab_order:
      - "tasks (index 0)"
      - "notes (index 1)"
      - "overview (index 2)"
      - "chat (index 3)"
      - "weekly (index 4)"
    
    swipe_configuration:
      threshold: "50px offset or 500 velocity"
      elastic:
        at_edges: "0.4 (stronger resistance)"
        between_tabs: "0.1 (subtle)"
      lockout: "350ms between swipes to prevent skipping"
    
    direction_logic: |
      Direction determines animation direction (enter from left/right):
      - direction = 1: Moving forward (e.g., tasks → notes)
      - direction = -1: Moving backward (e.g., notes → tasks)
    
    modal_blocking: |
      When any modal is open (isModalOpen = true):
      - Horizontal swipe gesture is disabled
      - This prevents accidental tab switches while using modals
  
  # ─────────────────────────────────────
  # BottomNav
  # ─────────────────────────────────────
  bottom_nav:
    file: "src/components/layout/BottomNav.tsx"
    description: "Floating pill navigation bar at the bottom"
    
    features:
      - "Only visible during drag/swipe (reveal on interaction)"
      - "Active tab has white pill indicator with layoutId animation"
      - "Pill tracks finger movement during swipe (parallax)"
    
    visibility: |
      Controlled by isVisible prop from NavigationShell.
      - isVisible = true: During active swipe drag
      - isVisible = false: Hidden when not dragging
    
    parallax_effect: |
      The white pill indicator moves opposite to swipe direction,
      creating a feeling that it's tracking toward the next tab.
      Implemented via useTransform on x motion value from NavigationShell.
    
    icons:
      tasks: "CheckCircle2"
      notes: "FileText"
      overview: "Layers"
      chat: "MessageSquare"
      weekly: "Calendar"


---
# ════════════════════════════════════════
# TASK SYSTEM
# ════════════════════════════════════════
tasks:
  # ─────────────────────────────────────
  # Task Type Definition
  # ─────────────────────────────────────
  type_definition:
    file: "src/types/index.ts"
    interface: |
      interface Task {
        id: string;
        title: string;
        dueTime?: string;
        dueDate?: string;
        priority: 'high' | 'medium' | 'low';
        tags: string[];
        isCompleted: boolean;
        description?: string;
      }
  
  # ─────────────────────────────────────
  # TasksTab
  # ─────────────────────────────────────
  tasks_tab:
    file: "src/components/features/tasks/TasksTab.tsx"
    description: "Main tasks list view with sorting and stagger animations"
    
    features:
      - "Tasks sorted by priority (high → medium → low)"
      - "Stagger entrance animation"
      - "Empty state with icon"
      - "Tap to open details, swipe to complete/delete"
    
    props:
      onOpenSettings: "() => void - Opens settings modal"
      onOpenDetails: "(item: any) => void - Opens card detail modal"
      onOpenQuickAdd: "(type?: 'task' | 'note') => void - Opens quick add modal"
  
  # ─────────────────────────────────────
  # TaskCard
  # ─────────────────────────────────────
  task_card:
    file: "src/components/features/tasks/TaskCard.tsx"
    description: "Swipeable task card with gesture actions"
    
    gesture_actions:
      swipe_right:
        threshold: "150px"
        action: "Complete (remove) task"
        feedback: "vibrate('success'), green border, scale up then shrink"
        animation: "completing variant - scale [1, 1.05, 0]"
      
      swipe_left:
        threshold: "150px"
        action: "Delete task (with optional confirmation)"
        feedback: "vibrate('medium'), red border"
        animation: "deleting variant - scale [1, 0.95, 0]"
      
      tap:
        action: "Open CardDetailModal"
        condition: "Only if drag offset < 5px"
    
    visual_elements:
      priority_dot: "2.5x2.5 circle with priority color"
      title: "Truncated, changes color on action state"
      due_time: "Clock icon + formatted dueDate (or legacy dueTime)"
      tag: "First tag displayed in pill"
    
    priority_colors:
      high: "#EF4444 (red)"
      medium: "#F59E0B (amber)"
      low: "#3B82F6 (blue)"
    
    background_indicators: |
      Behind the draggable card, there are indicator icons:
      - Left half: Green check icon (complete action)
      - Right half: Red trash icon (delete action)
      These are revealed as the card is dragged.


---
# ════════════════════════════════════════
# NOTES SYSTEM
# ════════════════════════════════════════
notes:
  # ─────────────────────────────────────
  # Note Type Definition
  # ─────────────────────────────────────
  type_definition:
    file: "src/types/index.ts"
    interface: |
      type NoteType = 'text' | 'voice' | 'image';
      
      interface Note {
        id: string;
        content: string;
        type: NoteType;
        tags: string[];
        date: string;
        title?: string;
        images?: string[];
      }
  
  # ─────────────────────────────────────
  # NotesTab
  # ─────────────────────────────────────
  notes_tab:
    file: "src/components/features/notes/NotesTab.tsx"
    description: "Notes grid view with 2-column layout"
    
    features:
      - "2-column CSS Grid layout (when notes exist)"
      - "Stagger entrance animation"
      - "Empty state fallback"
      - "Tap to open details"
    
    layout_logic: |
      When notes exist: grid grid-cols-2 gap-3 auto-rows-max
      When empty: flex flex-col (for centering empty state)
  
  # ─────────────────────────────────────
  # NoteCard
  # ─────────────────────────────────────
  note_card:
    file: "src/components/features/notes/NoteCard.tsx"
    description: "Individual note card with content preview"
    
    visual_elements:
      title: "Optional, displayed if present"
      content:
        text: "Line-clamped to 4 lines"
        image_attachments: "Thumbnail preview of images[0] with count badge"
        legacy_image: "Thumbnail preview (URL-based)"
      type_icon: "Mic (voice), Image, AlignLeft (text)"
      tag: "First tag in pill format"
    
    note_types:
      text: "Standard text content"
      voice: "Voice memo (content is transcript)"
      image: "Image URL (displayed as thumbnail)"


---
# ════════════════════════════════════════
# MODALS
# ════════════════════════════════════════
modals:
  shared_patterns:
    - "Bottom sheet slide-up animation"
    - "Drag-to-dismiss with threshold"
    - "Backdrop blur with click-to-close"
    - "useBackToClose for Android back button"
    - "useLockBodyScroll to prevent scroll-behind"
    - "Drag handle pill at the top"
  
  # ─────────────────────────────────────
  # QuickAddModal
  # ─────────────────────────────────────
  quick_add_modal:
    file: "src/components/features/overview/QuickAddModal.tsx"
    description: "Modal for quickly capturing new tasks, notes, ideas, or goals"
    
    features:
      - "Type selector grid (Task, Note, Idea, Goal)"
      - "Title input (optional)"
      - "Main content textarea"
      - "Voice input simulation (mock)"
      - "Priority selector (cycles through high/medium/low)"
      - "Accessory Toolbar: Date/Time picker (All) & Image attachments (Notes/Ideas only)"
      - "Processing and success states"
    
    item_types:
      task:
        icon: "CheckCircle2"
        saves_to: "DataContext.addTask()"
        default_priority: "medium"
      
      note:
        icon: "Hash"
        saves_to: "DataContext.addNote()"
      
      idea:
        icon: "Sparkles"
        saves_to: "DataContext.addNote() with 'idea' tag"
      
      goal:
        icon: "ArrowUp"
        saves_to: "DataContext.addTask() with 'goal' tag"
        default_priority: "high"
    
    states:
      idle: "Normal input state"
      listening: "Voice input active (mock)"
      processing: "Submitting, shows spinner"
      success: "Shows confirmation, auto-closes"
    
    props:
      isOpen: "boolean"
      onClose: "() => void"
      onAdd: "(item: FeedItem) => void - Optional callback"
      initialType: "'task' | 'note' | 'idea' | 'goal' - Pre-select type"
  
  # ─────────────────────────────────────
  # CardDetailModal
  # ─────────────────────────────────────
  card_detail_modal:
    file: "src/components/features/cards/CardDetailModal.tsx"
    description: "Full detail view for tasks and notes"
    
    features:
      - "Type badge and priority dot"
      - "Full title and content"
      - "Due time and date metadata"
      - "Action footer: Complete, Edit, Delete"
    
    props:
      isOpen: "boolean"
      onClose: "() => void"
      onDelete: "() => void - Called when delete confirmed"
      onComplete: "() => void - Called on complete"
      item:
        id: "string"
        title: "string"
        type: "'task' | 'note'"
        content: "string"
        tags: "string[] (optional)"
        dueTime: "string (optional)"
        priority: "'high' | 'medium' | 'low' (optional)"
    
    action_buttons:
      complete:
        size: "flex-1 (takes most space)"
        color: "bg-white text-black"
        action: "Calls onComplete, then onClose"
      
      edit:
        size: "w-16"
        color: "bg-white/5 text-neutral-400"
        action: "Currently just vibrates (placeholder)"
      
      delete:
        size: "w-16"
        color: "bg-red-500/10 text-red-500"
        action: "Shows ConfirmDeleteModal if confirmDelete setting is on"
  
  # ─────────────────────────────────────
  # ConfirmDeleteModal
  # ─────────────────────────────────────
  confirm_delete_modal:
    file: "src/components/features/cards/ConfirmDeleteModal.tsx"
    description: "Confirmation dialog before deletion"
    
    features:
      - "Centered modal (not bottom sheet)"
      - "Warning icon and message"
      - "Delete and Cancel buttons"
      - "Uses current spring config for animation"
    
    props:
      isOpen: "boolean"
      onClose: "() => void"
      onConfirm: "() => void - Called when delete confirmed"
      title: "string (default: 'Delete Item?')"
    
    usage: |
      Shown when confirmDelete setting is enabled and user:
      - Swipes left on TaskCard
      - Clicks delete in CardDetailModal


---
# ════════════════════════════════════════
# STYLING
# ════════════════════════════════════════
styling:
  # ─────────────────────────────────────
  # CSS Variables
  # ─────────────────────────────────────
  css_variables:
    file: "src/app/globals.css"
    
    colors:
      --background: "#0B0B0B (near-black)"
      --surface: "#121212 (dark gray)"
      --foreground: "#FFFFFF"
      --foreground-secondary: "#E5E5E5"
      --foreground-muted: "#9CA3AF"
      --priority-high: "#EF4444"
      --priority-medium: "#F59E0B"
      --priority-low: "#3B82F6"
    
    usage: |
      Use CSS variables for consistent theming:
      
      className="bg-[var(--background)]"
      className="bg-[var(--surface)]"
      className="text-[var(--foreground-muted)]"
  
  # ─────────────────────────────────────
  # App-Like Behavior CSS
  # ─────────────────────────────────────
  app_behavior:
    file: "src/app/globals.css"
    
    styles_applied:
      - "overscroll-behavior-y: none - Prevents pull-to-refresh"
      - "-webkit-tap-highlight-color: transparent - Removes tap highlight"
      - "user-select: none - Prevents text selection (app feel)"
      - "Scrollbar hidden globally"
  
  # ─────────────────────────────────────
  # Custom Utilities
  # ─────────────────────────────────────
  custom_utilities:
    py-safe-top: "padding-top: env(safe-area-inset-top)"
    pb-safe-bottom: "padding-bottom: env(safe-area-inset-bottom)"
    
    usage: |
      These utilities account for device notches and home indicators:
      
      <div className="py-safe-top pb-safe-bottom">
        Content
      </div>
  
  # ─────────────────────────────────────
  # Common Patterns
  # ─────────────────────────────────────
  common_patterns:
    card_container: |
      className="bg-[var(--surface)] rounded-2xl border border-white/5"
    
    section_header: |
      className="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 px-1"
    
    badge: |
      className="px-3 py-1 rounded-full bg-white/5 text-[10px] font-bold uppercase tracking-widest text-neutral-400 border border-white/5"
    
    priority_dot: |
      className={clsx("w-2.5 h-2.5 rounded-full", priorityColors[priority])}


---
# ════════════════════════════════════════
# LAYOUT HIERARCHY
# ════════════════════════════════════════
layout_hierarchy:
  description: |
    Understanding the component hierarchy is crucial for state flow and callbacks.
  
  tree: |
    layout.tsx (DataProvider → SettingsProvider → MotionProvider)
    └── page.tsx
        └── NavigationShell
            ├── TabContent (renders active tab)
            │   ├── TasksTab
            │   │   └── TaskCard
            │   ├── NotesTab
            │   │   └── NoteCard
            │   ├── Feed (Overview)
            │   ├── ChatTab
            │   └── WeeklyTab
            │       └── DayItem
            │
            ├── FAB (Floating Action Button)
            │
            ├── QuickAddModal
            ├── CardDetailModal
            │   └── ConfirmDeleteModal
            ├── SettingsModal
            │
            └── BottomNav
  
  callback_flow: |
    NavigationShell defines modal open/close handlers:
    - onOpenSettings → opens SettingsModal
    - onOpenDetails → opens CardDetailModal
    - onOpenQuickAdd → opens QuickAddModal
    
    These are passed down: NavigationShell → TabContent → Individual Tab
    
    Each tab can call these to open global modals.


---
# ════════════════════════════════════════
# WEEKLY TAB
# ════════════════════════════════════════
weekly_tab:
  file: "src/components/features/weekly/WeeklyTab.tsx"
  description: "Sprint/week view showing tasks distributed across days"
  
  features:
    - "Current sprint header with title"
    - "Progress ring showing completion percentage"
    - "Focus and Velocity metrics cards"
    - "7-day week list with stagger animation"
  
  week_calculation: |
    The view shows Monday through Sunday of the current week.
    Tasks are pseudo-randomly distributed (index % 7) for demo purposes.
    In production, tasks would be filtered by actual date.
  
  components:
    WeeklyTab: "Main view with header and day list"
    DayItem: "Individual day row with date and task count"


---
# ════════════════════════════════════════
# TIPS & BEST PRACTICES
# ════════════════════════════════════════
best_practices:
  animations:
    - "Always use useSlimySpring() for transitions"
    - "Wrap list items in motion.div with containerVariants for stagger"
    - "Use layout prop on motion components for smooth reorders"
    - "Use AnimatePresence with mode='sync' for exit animations"
  
  haptics:
    - "Use 'light' for minor interactions (taps, swipes)"
    - "Use 'medium' for significant actions (toggles, drag ends)"
    - "Use 'success' for completions and saves"
  
  modals:
    - "Always use useBackToClose and useLockBodyScroll"
    - "Include drag handle for swipe-to-dismiss"
    - "Use stagger animations inside modal content"
  
  state:
    - "Access data via useData() hook"
    - "Don't create parallel localStorage calls"
    - "Use updateSettings() for all setting changes"
  
  styling:
    - "Use CSS variables for colors: var(--background), var(--surface)"
    - "Prefer border-white/5 for subtle borders"
    - "Use rounded-2xl for cards, rounded-full for pills"


---
# ════════════════════════════════════════
# EXTENDING THE APP
# ════════════════════════════════════════
extending:
  adding_a_new_tab:
    steps:
      - "1. Create component in src/components/features/newtab/"
      - "2. Add tab ID to TabId type in src/types/index.ts"
      - "3. Add to TABS array in src/types/index.ts"
      - "4. Add icon to ICONS object in BottomNav.tsx"
      - "5. Add case in TabContent switch in NavigationShell.tsx"
  
  adding_a_new_data_type:
    steps:
      - "1. Define interface in src/types/index.ts"
      - "2. Add state, actions, and persistence in DataContext.tsx"
      - "3. Create component for displaying the data"
      - "4. Add mock data in src/data/mock.ts (optional)"
  
  adding_a_new_setting:
    steps:
      - "1. Add to AppSettings interface in DataContext.tsx"
      - "2. Add default value to DEFAULT_SETTINGS"
      - "3. (Optional) Add convenience methods in SettingsContext.tsx"
      - "4. Add UI control in SettingsModal.tsx"


---
# ════════════════════════════════════════
# QUICK REFERENCE
# ════════════════════════════════════════
quick_reference:
  imports:
    data: "import { useData } from '@/context/DataContext';"
    settings: "import { useSettings } from '@/context/SettingsContext';"
    motion: "import { useMotion } from '@/context/MotionContext';"
    toast: "import { useToast } from '@/context/ToastContext';"
    spring: "import { useSlimySpring } from '@/hooks/use-slimy-spring';"
    stagger: "import { UNIVERSAL_STAGGER_CONTAINER, createStaggerItemVariants } from '@/utils/animations';"
    haptics: "import { vibrate } from '@/utils/haptics';"
    back_close: "import { useBackToClose } from '@/hooks/use-back-to-close';"
    lock_scroll: "import { useLockBodyScroll } from '@/hooks/use-lock-body-scroll';"
  
  stagger_setup: |
    const springConfig = useSlimySpring();
    const containerVariants = UNIVERSAL_STAGGER_CONTAINER('standard');
    const itemVariants = createStaggerItemVariants(springConfig);
  
  spring_transition: |
    transition={useSlimySpring()}
  
  modal_essentials: |
    useBackToClose(isOpen, onClose);
    useLockBodyScroll(isOpen);



---
# ════════════════════════════════════════
# TOAST NOTIFICATION SYSTEM
# ════════════════════════════════════════
toast_system:
  file: "src/context/ToastContext.tsx"
  description: |
    Global toast notification system for feedback and error handling.
    Follows logic.yaml error_handling rules: never_fail_silently, always_show_toast, log_to_console.

  exports:
    ToastProvider:
      type: "React Component"
      usage: "Wrapped in layout.tsx (inside MotionProvider)"
    
    useToast:
      type: "React Hook"
      returns:
        toasts: "Toast[] - Current active toasts"
        showToast: "(message: string, type?: ToastType, duration?: number) => void"
        dismissToast: "(id: string) => void"
      
      usage: |
        import { useToast } from '@/context/ToastContext';
        
        function MyComponent() {
          const { showToast } = useToast();
          
          // Show different toast types
          showToast('Task completed! 🎉', 'success');
          showToast('Something went wrong', 'error');
          showToast('Check your input', 'warning');
          showToast('Note saved', 'info');
        }
  
  toast_types:
    success:
      color: "green-400"
      haptic: "success"
      icon: "CheckCircle"
    error:
      color: "red-400"
      haptic: "error"
      icon: "AlertCircle"
    warning:
      color: "amber-400"
      haptic: "warning"
      icon: "AlertTriangle"
    info:
      color: "blue-400"
      haptic: "light"
      icon: "Info"
  
  behavior:
    position: "top-right (fixed)"
    auto_dismiss: "3 seconds default"
    console_logging: "All toasts are logged to console"
    haptic_feedback: "Type-appropriate vibration on show"


---
# ════════════════════════════════════════
# STATE POPUP (MOOD CHECK-IN)
# ════════════════════════════════════════
state_popup:
  file: "src/components/features/overview/StatePopup.tsx"
  description: |
    Morning/evening emoji-based mood check-in popup. Auto-triggers based on
    time of day if user hasn't logged state today. Per logic.yaml state_popup spec.
  
  trigger_windows:
    morning: "5am - 12pm"
    evening: "6pm - 11pm"
    outside: "Popup not shown"
  
  emoji_options:
    - emoji: "🔥"
      label: "Fired Up"
    - emoji: "😊"
      label: "Good"
    - emoji: "😐"
      label: "Neutral"
    - emoji: "😔"
      label: "Low"
    - emoji: "😴"
      label: "Tired"
  
  data_storage:
    context: "DataContext.tsx"
    state_key: "stateHistory"
    localStorage_key: "life-os-state-history"
    entry_format: |
      {
        emoji: string,
        timestamp: string (ISO),
        timeOfDay: 'morning' | 'evening'
      }
  
  auto_trigger_logic: |
    1. On app load, check current hour
    2. Determine if in morning/evening window
    3. Check stateHistory for entry today with same timeOfDay
    4. If not found, show popup after 1.5s delay
  
  usage: |
    // In NavigationShell.tsx (already implemented)
    <StatePopup
      isOpen={isStatePopupOpen}
      onClose={() => setIsStatePopupOpen(false)}
      onSelect={(emoji) => saveState(emoji, timeOfDay)}
      currentEmoji={currentState?.emoji}
      timeOfDay={timeOfDay}
    />


---
# ════════════════════════════════════════
# MEMORY REVIEW CARDS
# ════════════════════════════════════════
memory_review:
  file: "src/components/features/overview/MemoryReviewCards.tsx"
  description: |
    Card-based review system for expiring notes (7+ days old).
    User can save permanently, archive, or delete. Accessed via Brain icon FAB on Overview tab.
  
  filter_logic: |
    Notes older than 7 days are considered "expiring" and shown in review.
  
  actions:
    swipe_right: "Save permanently"
    swipe_left: "Archive"
    swipe_down: "Delete"
    button_keep: "Save permanently"
    button_archive: "Archive"
    button_delete: "Delete"
  
  access:
    location: "Overview tab FAB area"
    icon: "Brain (Lucide)"
    trigger: "Tap Brain icon to open review modal"
  
  ui_features:
    - "Card stack with swipe gestures"
    - "List view toggle (per memory_review_logic.ui.list_toggle)"
    - "Progress indicator (X of Y notes)"
    - "Date and tags displayed on cards"
    - "Toast notifications for each action"
    - "Auto-close when all notes reviewed"
    - "Per-item action buttons in list mode"
  
  usage: |
    // In NavigationShell.tsx (already implemented)
    <MemoryReviewCards
      isOpen={isMemoryReviewOpen}
      onClose={() => setIsMemoryReviewOpen(false)}
    />


---
# ════════════════════════════════════════
# QUICK ADD MODAL
# ════════════════════════════════════════
quick_add:
  file: "src/components/features/overview/QuickAddModal.tsx"
  description: |
    Full-featured modal for quickly adding content. Supports multiple input types,
    voice input simulation, priority selection, due dates, and image attachments.
  
  input_types:
    task:
      icon: "CheckCircle2"
      storage: "DataContext.addTask()"
      default_priority: "medium"
    note:
      icon: "Hash"
      storage: "DataContext.addNote()"
      supports_images: true
    idea:
      icon: "Sparkles"
      storage: "DataContext.addNote() with tag: 'idea'"
      supports_images: true
    goal:
      icon: "ArrowUp"
      storage: "DataContext.addTask() with tag: 'goal'"
      default_priority: "high"
    identity:
      icon: "User"
      storage: "DataContext.addNote() with tag: 'identity'"
      description: "Per logic.yaml quick_add_modal.inputs.identity_update"
  
  features:
    - "5-column type selector grid"
    - "Priority cycle button (low → medium → high)"
    - "Date/time picker integration"
    - "Image attachment (note/idea only)"
    - "Voice input simulation"
    - "Swipe-down to close"
    - "Toast notification on success"
  
  flow: |
    1. user_input: Type selection + text/title input
    2. ai_parse: (future) AI categorization
    3. preview: (future) Show parsed result
    4. confirm: User submits
    5. save: Stored to DataContext + localStorage


---
# ════════════════════════════════════════
# TASK COMPLETION LOGIC
# ════════════════════════════════════════
task_completion:
  description: |
    Tasks now have proper complete vs delete separation per logic.yaml card_swipe spec.
  
  actions:
    swipe_right: |
      Calls completeTask(id) - marks task as isCompleted: true
      Task remains in storage but filtered from active views
      Shows success toast
    
    swipe_left: |
      Calls removeTask(id) - permanently deletes task
      Shows info toast (or confirmation modal if setting enabled)
    
    swipe_down: |
      Calls removeTask(id) - permanently deletes task
      Per logic.yaml card_swipe.down: delete
      Lower threshold (80px vs 150px for horizontal)
      Shows warning vibration
  
  where_implemented:
    - "TaskCard.tsx - Supports X+Y drag with separate thresholds"
    - "TasksTab.tsx - Uses completeTask() for swipe-right"
    - "Feed.tsx - Uses completeTask() for swipe-right"
  
  filtering:
    tasks_tab: "Shows only tasks where isCompleted === false"
    overview_feed: "Shows only tasks where isCompleted === false"
    weekly_tab: "Shows all tasks (uses completion for progress ring)"


---
# ════════════════════════════════════════
# RESPONSIVE DESKTOP LAYOUTS
# ════════════════════════════════════════
desktop_layouts:
  overview: |
    On desktop (md: 768px+), screens transition from mobile-first single-column 
    to optimized multi-column/centered layouts.
  
  # ─────────────────────────────────────
  # Quick Add Modal (Desktop)
  # ─────────────────────────────────────
  quick_add_desktop:
    file: "src/components/features/overview/QuickAddModal.tsx"
    layout: |
      - Centered modal box (fixed postion, scale/opacity animation)
      - Header "New Task" centered
      - Type selector: 4-column grid with labeled icons (Task, Note, Reminder, Idea)
      - Main input: Wider area with title and content fields
      - Action bar: Simplified with priority dot indicator and ArrowUp submit button
  
  # ─────────────────────────────────────
  # Tasks Tab (Desktop)
  # ─────────────────────────────────────
  tasks_tab_desktop:
    file: "src/components/features/tasks/TasksTab.tsx"
    layout: |
      - Header "TASKS" centered with wide tracking
      - List container: Centered with max-w-2xl width
    card_changes:
      - Left side: Circular checkbox (clickable)
      - Center: Inline priority dot + Title + Subtitle (time/date)
      - Right side: Category badge (tag)
  
  # ─────────────────────────────────────
  # Weekly Tab (Desktop)
  # ─────────────────────────────────────
  weekly_tab_desktop:
    file: "src/components/features/weekly/WeeklyTab.tsx"
    layout: |
      Two-column grid layout (Sidebar + Main Area):
      - Sidebar (Left): 
          - Sprint stats (Name, Progress Ring)
          - Metric cards (Focus, Velocity)
          - Sprint Insights (AI-driven summary)
          - "View Backlog" button
      - Main Area (Right):
          - "Weekly Agenda" header
          - Daily list with expanded spacing
  
  # ─────────────────────────────────────
  # Overview / Swipe Feed (Desktop)
  # ─────────────────────────────────────
  swipe_feed_desktop:
    file: "src/components/features/overview/SwipeFeed.tsx"
    layout: |
      Transitions from vertical stack to Horizontal Carousel:
      - Center: Large active card
      - Sides: Partially visible, blurred/rotated placeholders for prev/next
      - Navigation: "PREV" and "NEXT" labels with icons
      - Pagination: 5 horizontal dots indicating position


---
# ════════════════════════════════════════
# NOTIFICATION & TOAST SYSTEM
# ════════════════════════════════════════
notifications:
  toast_system:
    file: "src/context/ToastContext.tsx"
    description: "Premium notification system with single-toast logic."
    behavior:
      single_mode: "Only one toast is shown at a time. New toasts trigger exit of old ones first."
      animation: "Uses AnimatePresence with mode='popLayout' for sequential transitions."
      dismissal: "Supports horizontal swipe-to-dismiss in both directions."
  
  attention_indicators:
    brain_fab:
      file: "src/components/layout/NavigationShell.tsx"
      description: "Memory Review FAB (Brain icon) shows a red notification bubble."
      logic: "Count of notes expiring within 3 days. Computed via memoized useData hook."


---
# ════════════════════════════════════════
# PERFORMANCE OPTIMIZATIONS
# ════════════════════════════════════════
performance:
  lazy_loading:
    description: |
      All tab components are lazy-loaded using next/dynamic to reduce initial bundle size.
      Per logic.yaml performance_rules.lazy_load_tabs.
    
    implementation: |
      // In NavigationShell.tsx
      const Feed = dynamic(() => import('@/components/features/overview/Feed').then(mod => ({ default: mod.Feed })), {
        loading: () => <TabLoadingState />,
      });
    
    loading_state: |
      TabLoadingState shows a centered spinning loader while tab loads.
      Typically only visible on slow connections or first load.
    
    tabs_lazy_loaded:
      - Feed (Overview)
      - TasksTab
      - NotesTab
      - WeeklyTab
      - ChatTab
  
  memoization:
    description: "Heavy computations are memoized with useMemo"
    examples:
      - "sortedTasks in TasksTab - sorted by priority"
      - "sortedItems in Feed - sorted by overdue then priority"
      - "weekData in WeeklyTab - computed week days"
      - "expiringNotes in MemoryReviewCards - filtered by date"


---
# ════════════════════════════════════════
# TESTING
# ════════════════════════════════════════
testing:
  framework: "Vitest with React Testing Library"
  config_file: "vitest.config.ts"
  setup_file: "src/__tests__/setup.ts"
  
  run_commands:
    all_tests: "npm test"
    single_run: "npm run test:run"
    with_coverage: "npm run test:coverage"
  
  test_files:
    swipe_thresholds:
      file: "src/__tests__/swipe-thresholds.test.tsx"
      tests:
        - "TaskCard rendering"
        - "Threshold constant validation (150px horizontal, 80px vertical)"
        - "XY drag support verification"
    
    tab_snapping:
      file: "src/__tests__/tab-snapping.test.ts"
      tests:
        - "Tab order verification"
        - "Swipe offset threshold (50px)"
        - "Velocity threshold (500px/s)"
        - "Edge constraints"
        - "Tab transitions"
    
    modal_open_close:
      file: "src/__tests__/modal-open-close.test.ts"
      tests:
        - "useBackToClose hook behavior"
        - "useLockBodyScroll hook behavior"
        - "Modal state management"
        - "Multiple modal prevention"
    
    state_popup_flow:
      file: "src/__tests__/state-popup-flow.test.ts"
      tests:
        - "Time of day detection (morning/evening windows)"
        - "Has logged state today check"
        - "Emoji options validation"
        - "State entry creation"
        - "Auto-trigger logic"
  
  mocking:
    description: |
      Test setup mocks these dependencies to avoid side effects:
    mocked_modules:
      - "framer-motion (simplified components)"
      - "@/utils/haptics (vibrate function)"
      - "next/dynamic (component loading)"
      - "localStorage (in-memory mock)"
      - "matchMedia (responsive queries)"
      - "ResizeObserver (element sizing)"


# ═══════════════════════════════════════════════════════════════════════════════════
# END OF DOCUMENTATION
# ═══════════════════════════════════════════════════════════════════════════════════
